// ===============================
// azuredeploy.json - ARM Template with Boolean Parameters for Log Sources
// ===============================
{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspaceName": {
      "type": "string",
      "metadata": {
        "description": "Name of the existing Log Analytics Workspace where Microsoft Sentinel is enabled."
      }
    },
    "workspaceResourceGroup": {
      "type": "string",
      "metadata": {
        "description": "Resource Group name of the existing Log Analytics Workspace."
      }
    },
    "enableAzureActivity": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Azure Activity logs"
      }
    },
    "enableSentinelHealth": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Sentinel Health monitoring"
      }
    },
    "enableOffice365": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Office 365 logs (Exchange, SharePoint, Teams)"
      }
    },
    "enableEntraIDProtection": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Entra ID Protection logs"
      }
    },
    "enableDefenderEndpoint": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Defender for Endpoint logs"
      }
    },
    "enableDefenderIdentity": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Defender for Identity logs"
      }
    },
    "enableDefenderCloudApps": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Defender for Cloud Apps logs"
      }
    },
    "enableDefenderCloud": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Defender for Cloud logs"
      }
    },
    "enableDefenderIoT": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Defender for IoT logs"
      }
    },
    "enableDefenderXDRIncidents": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Defender XDR Incidents"
      }
    },
    "enableDefenderXDRAlerts": {
      "type": "bool",
      "defaultValue": false,
      "metadata": {
        "description": "Enable Defender XDR Alerts"
      }
    }
  },
  "variables": {
    "workspaceResourceId": "[resourceId(parameters('workspaceResourceGroup'), 'Microsoft.OperationalInsights/workspaces', parameters('workspaceName'))]"
  },
  "resources": [
    // Azure Activity (already provided)
    {
      "condition": "[parameters('enableSentinelHealth')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-sentinelhealth')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-sentinelhealth",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-sentinelhealth",
        "displayName": "Sentinel Health Monitoring",
        "version": "1.0.0"
      }
    },
    {
      "condition": "[parameters('enableOffice365')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-office365')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-office365",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-office365",
        "displayName": "Office 365",
        "version": "3.0.2"
      }
    },
    {
      "condition": "[parameters('enableEntraIDProtection')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-entra-id-riskalerts')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-entra-id-riskalerts",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-entra-id-riskalerts",
        "displayName": "Entra ID Protection Alerts",
        "version": "1.0.0"
      }
    },
    {
      "condition": "[parameters('enableDefenderEndpoint')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-microsoftdefenderadvancedthreatprotection')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-microsoftdefenderadvancedthreatprotection",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-microsoftdefenderadvancedthreatprotection",
        "displayName": "Microsoft Defender for Endpoint",
        "version": "3.0.2"
      }
    },
    {
      "condition": "[parameters('enableDefenderIdentity')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-microsoftdefenderforidentity')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-microsoftdefenderforidentity",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-microsoftdefenderforidentity",
        "displayName": "Microsoft Defender for Identity",
        "version": "2.0.2"
      }
    },
    {
      "condition": "[parameters('enableDefenderCloudApps')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-microsoftcloudappsecurity')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-microsoftcloudappsecurity",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-microsoftcloudappsecurity",
        "displayName": "Microsoft Defender for Cloud Apps",
        "version": "3.0.2"
      }
    },
    {
      "condition": "[parameters('enableDefenderCloud')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-microsoftdefenderforcloud')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-microsoftdefenderforcloud",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-microsoftdefenderforcloud",
        "displayName": "Microsoft Defender for Cloud",
        "version": "3.0.1"
      }
    },
    {
      "condition": "[parameters('enableDefenderIoT')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-microsoftdefenderforiot')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-microsoftdefenderforiot",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-microsoftdefenderforiot",
        "displayName": "Microsoft Defender for IoT",
        "version": "3.0.0"
      }
    },
    {
      "condition": "[parameters('enableDefenderXDRAlerts')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-microsoft365defender')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-microsoft365defender",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-microsoft365defender",
        "displayName": "Microsoft Defender XDR",
        "version": "3.0.3"
      }
    },
    {
      "condition": "[parameters('enableDefenderXDRIncidents')]",
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspaceName'), '/Microsoft.SecurityInsights/azuresentinel.azure-sentinel-solution-microsoft365defender-incidents')]",
      "properties": {
        "contentId": "azuresentinel.azure-sentinel-solution-microsoft365defender",
        "contentKind": "Solution",
        "contentProductId": "azuresentinel.azure-sentinel-solution-microsoft365defender",
        "displayName": "Microsoft Defender XDR - Incidents",
        "version": "3.0.3"
      }
    }
  ],
  "outputs": {
    "workspaceResourceId": {
      "type": "string",
      "value": "[variables('workspaceResourceId')]"
    },
    "deploymentStatus": {
      "type": "string",
      "value": "[concat('Deployment completed for workspace: ', parameters('workspaceName'))]"
    }
  }
}
